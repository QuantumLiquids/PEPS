# Release v0.0.3

**Date**: 2026-01-31
**Type**: Release
**Status**: COMPLETED
**Git range**: `v0.0.2..v0.0.3`

## Highlights

- **PBC VMC via TRG**: Full variational Monte Carlo support for periodic boundary conditions using the Tensor Renormalization Group contractor. Built-in model solvers for Heisenberg, TFIM, and J1-J2 XXZ boson on PBC lattices.
- **Unified OBC/PBC API**: `VmcOptimize()` and `MonteCarloMeasure()` auto-dispatch between `BMPSContractor` (OBC) and `TRGContractor` (PBC) based on the `SplitIndexTPS` boundary condition, via `if constexpr`.
- **Adam/AdamW optimizer**: New adaptive-rate optimizer with decoupled weight decay, bias-corrected moment estimates, and lazy initialization.
- **TRG performance**: Optimized shadow-RG, commit, and backpropagation hot paths; batch punch-hole backprop; improved PBC TRG cache reuse.

## Bug Fixes

- **Fix complex Adam/AdaGrad accumulators**: AdaGrad and Adam squared-gradient accumulators used `ElementWiseSquare` (`z*z`), which is incorrect for complex types. Replaced with `ElementWiseSquaredNorm` (`|z|^2 = z * conj(z)`), delegating to the upstream `QLTensor::ElementWiseSquaredNorm()`. This fixes `test_optimizer_adam_exact_sum_complex` and `test_optimizer_adagrad_exact_sum_complex`.
- **Fix UpdateSingleSite_ behavior**: Corrected invalid update behavior and added tests to prevent regressions.
- **TRG numerical stability fixes**: Stabilized TRG truncation paths and refactored truncation parameters for correctness.

## New Features

- **TRG read-only replacement evaluation** for efficient energy evaluation without modifying the TRG state.
- **Spin structure factor measurement** with `StructureFactorMixin` and `BMPSWalker` BTen cache for O(Lx) measurement cost.
- **Hubbard NN U1U1 Updater** for VMC/Measure.
- **`SplitIndexTPS::ElementWiseSquaredNorm()`**: New element-wise operation returning `|z|^2` per element; correct for both real and complex types.

## Improvements

- **Truncation params refactor**: Unified truncation parameter types across BMPS and TRG.
- **Richer optimizer header**: Extended optimizer logging with timing breakdown (EvalT, UpdateT, TotT).
- **MPI config rescue death test**: Explicit test for configuration rescue under MPI.
- **BMPSContractor split**: Further cleanup of implementation files and API surface.
- **NNN simple update improvements**: Improved update path and coverage for NNN simple update.
- **SimpleUpdateTruncatePara `inv_tol`**: Added tolerance parameter to control inverse stability.
- **Off-diagonal correlation retrieval**: Exposed off-diagonal correlation measures for better diagnostics.
- **PSI consistency warnings**: Unified warning behavior across update paths.
- **VMC trial API**: Replace `pending_trial` with an explicit Trial token API in the Monte Carlo engine and related optimizer/measurer paths.
- **Configuration rescue**: Add `WaveFunctionSum`, parameterized rescue thresholds, and tighter diagnostics for Monte Carlo stability.

## Test Status

- All fast tests and slow tests pass. Integration tests (MPI multi-node) not run for this release.

## Notes

- Singlet pair correlation for t-J remains disabled due to fermion sign handling; the code emits a clear error to avoid silent wrong results.

## References (detailed notes)

- `changelog/details/2025-12-25-release-v0.0.2.md` (previous release)
